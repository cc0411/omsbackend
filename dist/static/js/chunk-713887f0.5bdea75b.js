(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-713887f0"],{"4c48":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",[a("div",{staticClass:"d2-mt d2-mr"},[a("el-card",{staticClass:"d2-card d2-mb"},[a("el-row",[a("el-col",{attrs:{span:4}},[a("div",{staticClass:"treeheader"},[a("h3",[t._v("业务线树")])]),a("div",{staticClass:"treenav"},[a("el-tree",{attrs:{"current-node-key":"",data:t.treedata,props:t.defaultProps,accordion:""},on:{"node-click":t.handleNodeClick}})],1)]),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"handle-box"},[a("div",{staticClass:"handle-head"},[a("el-button",{attrs:{size:"mini",type:"danger",round:"",disabled:0===this.multipleSelection.length||this.disabled},on:{click:t.delAll}},[t._v("批量删除\n                            ")]),a("el-button",{attrs:{size:"mini",type:"success",round:""},on:{click:t.handleAdd}},[t._v("添加主机")]),a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"请选择"},on:{change:t.changeStatus},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[a("el-option",{attrs:{label:"上线",value:"online"}}),a("el-option",{attrs:{label:"下线",value:"offline"}})],1),a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"请选择"},on:{change:t.changeServerType},model:{value:t.listQuery.server_type,callback:function(e){t.$set(t.listQuery,"server_type",e)},expression:"listQuery.server_type"}},[a("el-option",{attrs:{label:"物理机",value:"physical"}}),a("el-option",{attrs:{label:"虚拟机",value:"virtual"}}),a("el-option",{attrs:{label:"云主机",value:"instance"}})],1),a("div",{staticClass:"search"},[a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"搜索关键词",size:"mini"},model:{value:t.searchdata,callback:function(e){t.searchdata=e},expression:"searchdata"}}),a("el-button",{attrs:{size:"mini",round:"",type:"primary",icon:"search"},on:{click:t.searchClick}},[t._v("搜索\n                                ")]),a("el-button",{attrs:{size:"mini",round:"",icon:"refresh"},on:{click:t.refreshClick}},[t._v("重置")])],1)],1),a("div",{staticClass:"download"},[a("el-form",{attrs:{inline:!0,size:"mini"}},[a("el-form-item",{attrs:{label:"已选数据下载 [ "+t.multipleSelection.length+" ]"}},[a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:0===t.multipleSelection.length},on:{click:function(e){t.handleDownloadXlsx(t.multipleSelection)}}},[t._v("\n                                            xlsx\n                                        ")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:0===t.multipleSelection.length},on:{click:function(e){t.handleDownloadCsv(t.multipleSelection)}}},[t._v("\n                                            csv\n                                        ")])],1)],1)],1)],1),t.HostsData.length>0?a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.HostsData,"max-height":"500","tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-posotion":"left",inline:""}},[a("el-form-item",{attrs:{label:"CPU"}},[a("span",[t._v(t._s(e.row.cpu_info))])]),a("el-form-item",{attrs:{label:"系统"}},[a("span",[t._v(t._s(e.row.os))])]),a("el-form-item",{attrs:{label:"内存"}},[a("span",[t._v(t._s(e.row.memory))])]),a("el-form-item",{attrs:{label:"硬盘"}},[a("span",[t._v(t._s(e.row.disk))])]),a("el-form-item",{attrs:{label:"SN"}},[a("span",[t._v(t._s(e.row.sn))])]),a("el-form-item",{attrs:{label:"主机组"}},t._l(e.row.group,function(e){return a("span",[t._v(t._s(e)+"  ")])})),a("el-form-item",{attrs:{label:"业务线"}},[a("span",[t._v(t._s(e.row.business_unit))])]),a("el-form-item",{attrs:{label:"描述"}},[a("span",[t._v(t._s(e.row.desc))])])],1)]}}])}),a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{prop:"hostname",label:"主机名",sortable:"custom",width:"120"}}),a("el-table-column",{attrs:{prop:"wip",fixed:"",label:"外网地址",sortable:"custom",width:"120"}}),a("el-table-column",{attrs:{prop:"nip",label:"内网地址",sortable:"custom",width:"120"}}),a("el-table-column",{attrs:{prop:"idc",label:"机房",width:"120"}}),a("el-table-column",{attrs:{prop:"server_type",label:"类型",width:"100",aligin:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"left"},attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{staticStyle:{color:"#000"},attrs:{color:t.ASSET_TYPE[e.row.server_type].color}},[t._v("\n                                            "+t._s(t.ASSET_TYPE[e.row.server_type].type)+"\n                                        ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"instance_id",label:"云主机ID",width:"180"}}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",aligin:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"left"},attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{type:t.ASSET_STATUS[e.row.status].type}},[t._v("\n                                            "+t._s(t.ASSET_STATUS[e.row.status].status)+"\n                                        ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"ctime",label:"创建时间",width:"150",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"name-wrapper",staticStyle:{"text-align":"left",color:"rgb(0,0,0)"},attrs:{slot:"reference"},slot:"reference"},[a("span",[t._v(t._s(t._f("parseDate")(e.row.ctime)))])])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200",aligin:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(a){t.handleEdit(e.row)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){t.handleDelete(e.row)}}})]}}])})],1):t._e(),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,50,100,500],"page-size":t.listQuery.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.tabletotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.listQuery,"page",e)}}})],1)],1)])],1),a("Hostdialog",{attrs:{dialog:t.dialog,rowdata:t.rowdata,FormData:t.FormData},on:{updatehosts:t.getHostData}})],1)],1)])},s=[],o=a("efa4"),r=(a("25d7"),a("9ce1"),a("932b")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hostdialog"},[a("el-dialog",{attrs:{title:t.dialog.title,visible:t.dialog.show,"close-on-click-modal":!1,"close-on-press-escape":!1,"modal-append-to-body":!1},on:{"update:visible":function(e){t.$set(t.dialog,"show",e)}}},[a("div",{staticClass:"form"},[a("el-form",{ref:"hostform",attrs:{model:t.FormData,rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"主机名",prop:"hostname"}},[a("el-input",{model:{value:t.FormData.hostname,callback:function(e){t.$set(t.FormData,"hostname",e)},expression:"FormData.hostname"}}),t.hosterror?a("span",{staticClass:"error-text"},[t._v(t._s(t.hosterror))]):t._e()],1),a("el-form-item",{attrs:{label:"外网地址",prop:"wip"}},[a("el-input",{model:{value:t.FormData.wip,callback:function(e){t.$set(t.FormData,"wip",e)},expression:"FormData.wip"}}),t.wiperror?a("span",{staticClass:"error-text"},[t._v(t._s(t.wiperror))]):t._e()],1),a("el-form-item",{attrs:{label:"内网地址",prop:"nip"}},[a("el-input",{model:{value:t.FormData.nip,callback:function(e){t.$set(t.FormData,"nip",e)},expression:"FormData.nip"}}),t.niperror?a("span",{staticClass:"error-text"},[t._v(t._s(t.niperror))]):t._e()],1),a("el-form-item",{attrs:{label:"设备类型",prop:"server_type"}},[a("el-select",{attrs:{placeholder:"请选择设备类型"},model:{value:t.FormData.server_type,callback:function(e){t.$set(t.FormData,"server_type",e)},expression:"FormData.server_type"}},t._l(t.ASSET_TYPE,function(t){return a("el-option",{key:t.key,attrs:{label:t.name,value:t.key}})}))],1),a("el-form-item",{attrs:{label:"主机状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"请选择主机状态"},model:{value:t.FormData.status,callback:function(e){t.$set(t.FormData,"status",e)},expression:"FormData.status"}},t._l(t.ASSET_STATUS,function(t){return a("el-option",{key:t.key,attrs:{label:t.name,value:t.key}})}))],1),a("el-form-item",{attrs:{label:"云主机ID",prop:"instance_id"}},[a("el-input",{model:{value:t.FormData.instance_id,callback:function(e){t.$set(t.FormData,"instance_id",e)},expression:"FormData.instance_id"}})],1),a("el-form-item",{attrs:{label:"SN编号",prop:"sn"}},[a("el-input",{model:{value:t.FormData.sn,callback:function(e){t.$set(t.FormData,"sn",e)},expression:"FormData.sn"}})],1),a("el-form-item",{attrs:{label:"CPU",prop:"cpu_info"}},[a("el-input",{model:{value:t.FormData.cpu_info,callback:function(e){t.$set(t.FormData,"cpu_info",e)},expression:"FormData.cpu_info"}})],1),a("el-form-item",{attrs:{label:"内存",prop:"memory"}},[a("el-input",{model:{value:t.FormData.memory,callback:function(e){t.$set(t.FormData,"memory",e)},expression:"FormData.memory"}})],1),a("el-form-item",{attrs:{label:"硬盘",prop:"disk"}},[a("el-input",{model:{value:t.FormData.disk,callback:function(e){t.$set(t.FormData,"disk",e)},expression:"FormData.disk"}})],1),a("el-form-item",{attrs:{label:"系统",prop:"os"}},[a("el-input",{model:{value:t.FormData.os,callback:function(e){t.$set(t.FormData,"os",e)},expression:"FormData.os"}})],1),a("el-form-item",{attrs:{label:"机房",prop:"idc"}},[a("el-select",{attrs:{placeholder:"请选择机房"},model:{value:t.FormData.idc,callback:function(e){t.$set(t.FormData,"idc",e)},expression:"FormData.idc"}},t._l(t.IdcData,function(t){return a("el-option",{key:t.name,attrs:{value:t.name}})}))],1),a("el-form-item",{attrs:{label:"主机组",prop:"group"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择主机组"},model:{value:t.FormData.group,callback:function(e){t.$set(t.FormData,"group",e)},expression:"FormData.group"}},t._l(t.GroupData,function(t){return a("el-option",{key:t.name,attrs:{value:t.name}})}))],1),a("el-form-item",{attrs:{label:"业务线",prop:"business_unit"}},[a("el-select",{attrs:{placeholder:"请选择业务线"},model:{value:t.FormData.business_unit,callback:function(e){t.$set(t.FormData,"business_unit",e)},expression:"FormData.business_unit"}},t._l(t.BusinessUnitData,function(t){return a("el-option",{key:t.name,attrs:{value:t.name}})}))],1),a("el-form-item",{attrs:{label:"主机描述",prop:"desc"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.FormData.desc,callback:function(e){t.$set(t.FormData,"desc",e)},expression:"FormData.desc"}})],1),a("el-form-item",[a("el-form-item",[a("p",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-text"},[t._v(t._s(t.error))]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.onSubmit("hostform")}}},[t._v("提交")]),a("el-button",{on:{click:function(e){t.dialog.show=!1}}},[t._v("取消")])],1)],1)],1)],1)])],1)},l=[],c={name:"Hostdialog",props:{dialog:Object,FormData:Object,rowdata:Object},created:function(){this.getGroupData(),this.getBusinessUnitsData(),this.getIdcData()},data:function(){return{GroupData:{},IdcData:{},BusinessUnitData:{},ASSET_STATUS:[{key:"online",name:"上线"},{key:"offline",name:"下线"}],ASSET_TYPE:[{key:"physical",name:"物理机"},{key:"virtual",name:"虚拟机"},{key:"instance",name:"云主机"}],error:!1,hosterror:!1,wiperror:!1,niperror:!1,rules:{hostname:[{required:!0,message:"主机名不能为空",trigger:"blur"}]}}},methods:{onSubmit:function(t){var e=this,a=this;this.$refs[t].validate(function(t){if(t){var n="add"==e.dialog.option?Object(r["c"])(e.FormData):Object(r["p"])(e.rowdata.id,e.FormData);n.then(function(t){e.$message.success("添加更新成功"),e.dialog.show=!1,e.$emit("updatehosts")}).catch(function(t){var e=t.response.data;"non_field_errors"in e&&(a.error=e.non_field_errors[0]),"hostname"in e&&(a.hostnameerror=e.hostname[0]),"wip"in e&&(a.wiperror=e.wip[0]),"nip"in e&&(a.niperror=e.nip[0])})}else e.$message.error("失败了！")})},getGroupData:function(){var t=this;Object(r["j"])().then(function(e){t.GroupData=e}).catch(function(t){console.log(t)})},getIdcData:function(){var t=this;Object(r["l"])().then(function(e){t.IdcData=e}).catch(function(t){console.log(t)})},getBusinessUnitsData:function(){var t=this;Object(r["i"])({}).then(function(e){t.BusinessUnitData=e}).catch(function(t){console.log(t)})}}},u=c,p=(a("9fb7"),a("048f")),d=Object(p["a"])(u,i,l,!1,null,"6463ab14",null);d.options.__file="Hostdialog.vue";var m=d.exports,h={name:"Hosts",created:function(){this.getHostData(),this.getTreeData()},components:{Hostdialog:m},data:function(){return{treedata:[],defaultProps:{id:"id",label:"name",children:"group"},FormData:{hostname:"",wip:"",nip:"",status:"",server_type:"",sn:"",instance_id:"",idc:"",group:"",business_unit:"",desc:"",cpu_info:"",memory:0,disk:0,os:""},dialog:{show:!1,title:"",option:"edit"},rowdata:{},searchdata:"",disabled:!1,group:null,tabletotal:0,HostsData:[],multipleSelection:[],listQuery:{page:1,page_size:10,search:"",status:"",server_type:"",ordering:"",business_unit:""},ASSET_TYPE:{physical:{type:"物理机",color:"#c0dbff"},virtual:{type:"虚拟机",color:"#19ddff"},instance:{type:"云主机",color:"#f06292"}},ASSET_STATUS:{online:{status:"上线",type:"primary"},offline:{status:"下线",type:"info"}},downloadColumns:[{label:"主机名",prop:"hostname"},{label:"外网地址",prop:"wip"},{label:"内网地址",prop:"nip"},{label:"状态",prop:"status"},{label:"主机类型",prop:"server_type"},{label:"SN",prop:"sn"},{label:"云主机ID",prop:"instance_id"},{label:"机房",prop:"idc"},{label:"角色",prop:"role"},{label:"业务线",prop:"business_unit"},{label:"CPU",prop:"cpu_info"},{label:"内存",prop:"memory"},{label:"硬盘",prop:"disk"},{label:"系统",prop:"os:"}]}},methods:{getTreeData:function(){var t=this;Object(r["m"])().then(function(e){t.treedata=e}).catch(function(t){console.log(t)})},getHostData:function(){var t=this;null!=this.group?Object(r["k"])({group:this.group,page:this.listQuery.page,page_size:this.listQuery.page_size,search:this.listQuery.search,status:this.listQuery.status,server_type:this.listQuery.server_type,ordering:this.listQuery.ordering,business_unit:this.listQuery.business_unit}).then(function(e){t.HostsData=e.results,t.tabletotal=e.count}).catch(function(t){console.log(t)}):Object(r["k"])(this.listQuery).then(function(e){t.HostsData=e.results,t.tabletotal=e.count}).catch(function(t){console.log(t)})},sortChange:function(t){var e=t.prop,a=t.order;"wip"===e?this.sortBywip(a):"nip"===e?this.sortBynip(a):"ctime"===e?this.sortByctime(a):"hostname"===e&&this.sortByhostname(a)},sortBywip:function(t){this.listQuery.ordering="ascending"===t?"wip":"-wip",this.getHostData()},sortBynip:function(t){this.listQuery.ordering="ascending"===t?"nip":"-nip",this.getHostData()},sortByhostname:function(t){this.listQuery.ordering="ascending"===t?"hostname":"-hostname",this.getHostData()},sortByctime:function(t){this.listQuery.ordering="ascending"===t?"ctime":"-ctime",this.getHostData()},handleSelectionChange:function(t){this.multipleSelection=t},delAll:function(){var t=this;this.$confirm("确定要删除吗？").then(function(){t.multipleSelection.forEach(function(e){Object(r["e"])(e.id).then(function(e){t.$message.success("恭喜你，删除成功"),t.multipleSelection=[],t.getHostData()}).catch(function(e){t.$message.error("删除失败"),console.log(e)})})}).catch(function(e){t.$message.info("点错了"),console.log(e)})},handleDelete:function(t){var e=this;this.$confirm("确定要删除吗？").then(function(){Object(r["e"])(t.id).then(function(t){e.$message({message:"恭喜你，删除成功",type:"success"}),e.getHostData()})}).catch(function(t){e.$message.info("点错了"),console.log(t)})},handleEdit:function(t){this.dialog={title:"编辑主机",show:!0,option:"edit"},this.rowdata=t,this.FormData={hostname:t.hostname,wip:t.wip,nip:t.nip,status:t.status,server_type:t.server_type,sn:t.sn,instance_id:t.instance_id,idc:t.idc,group:t.group,business_unit:t.business_unit,desc:t.desc,cpu_info:t.cpu_info,memory:t.memory,disk:t.disk,os:t.os}},handleAdd:function(){this.dialog={title:"添加主机",show:!0,option:"add"}},refreshClick:function(){this.listQuery={page:1,page_size:10,search:"",status:"",server_type:"",ordering:"",business_unit:""},this.getHostData()},searchClick:function(){this.listQuery.search=this.searchdata,this.getHostData()},handleNodeClick:function(t){t.group?(this.listQuery.business_unit=t.id,this.group=null):this.group=t.id,this.getHostData()},changeStatus:function(t){this.listQuery.status=t,this.getHostData()},changeServerType:function(t){this.listQuery.server_type=t,this.getHostData()},handleCurrentChange:function(t){this.listQuery.page=t,this.getHostData()},handleSizeChange:function(t){this.listQuery.page_size=t,this.getHostData()},downloadDataTranslate:function(t){return t.map(function(t){return Object(o["a"])({},t,{type:t.type?"禁用":"正常",used:t.used?"已使用":"未使用"})})},handleDownloadXlsx:function(t){var e=this;this.$export.excel({title:"主机列表",columns:this.downloadColumns,data:this.downloadDataTranslate(t)}).then(function(){e.$message("导出xlsx成功")})},handleDownloadCsv:function(t){var e=this;this.$export.csv({title:"主机列表",columns:this.downloadColumns,data:this.downloadDataTranslate(t)}).then(function(){e.$message("导出CSV成功")})}}},f=h,b=(a("da17"),Object(p["a"])(f,n,s,!1,null,"2d979273",null));b.options.__file="Hosts.vue";e["default"]=b.exports},"5a39":function(t,e,a){},"78ff":function(t,e,a){},"932b":function(t,e,a){"use strict";a.d(e,"c",function(){return o}),a.d(e,"e",function(){return r}),a.d(e,"p",function(){return i}),a.d(e,"k",function(){return l}),a.d(e,"d",function(){return c}),a.d(e,"l",function(){return u}),a.d(e,"q",function(){return p}),a.d(e,"h",function(){return d}),a.d(e,"b",function(){return m}),a.d(e,"j",function(){return h}),a.d(e,"o",function(){return f}),a.d(e,"g",function(){return b}),a.d(e,"a",function(){return g}),a.d(e,"i",function(){return _}),a.d(e,"m",function(){return v}),a.d(e,"n",function(){return y}),a.d(e,"f",function(){return D});var n=a("9bd2"),s="http://127.0.0.1:8000",o=function(t){return n["a"].post("".concat(s,"/api/assets/"),t)};function r(t){return Object(n["a"])({url:"".concat(s,"/api/assets/")+t+"/",method:"delete"})}function i(t,e){return Object(n["a"])({url:"".concat(s,"/api/assets/")+t+"/",method:"patch",data:e})}function l(t){return Object(n["a"])({url:"".concat(s,"/api/assets/"),method:"get",params:t})}function c(t){return Object(n["a"])({url:"".concat(s,"/api/idc/"),method:"post",data:t})}var u=function(){return n["a"].get("".concat(s,"/api/idc/"))};function p(t,e){return Object(n["a"])({url:"".concat(s,"/api/idc/")+t+"/",method:"patch",data:e})}function d(t){return Object(n["a"])({url:"".concat(s,"/api/idc/")+t+"/",method:"delete"})}function m(t){return Object(n["a"])({url:"".concat(s,"/api/group/"),method:"post",data:t})}var h=function(){return n["a"].get("".concat(s,"/api/group/"))};function f(t,e){return Object(n["a"])({url:"".concat(s,"/api/group/")+t+"/",method:"patch",data:e})}function b(t){return Object(n["a"])({url:"".concat(s,"/api/group/")+t+"/",method:"delete"})}function g(t){return Object(n["a"])({url:"".concat(s,"/api/businessunit/"),method:"post",data:t})}var _=function(t){return n["a"].get("".concat(s,"/api/businessunit/"))},v=function(t){return n["a"].get("".concat(s,"/api/tree/"))};function y(t,e){return Object(n["a"])({url:"".concat(s,"/api/businessunit/")+t+"/",method:"patch",data:e})}function D(t){return Object(n["a"])({url:"".concat(s,"/api/businessunit/")+t+"/",method:"delete"})}},"9fb7":function(t,e,a){"use strict";var n=a("5a39"),s=a.n(n);s.a},da17:function(t,e,a){"use strict";var n=a("78ff"),s=a.n(n);s.a}}]);
//# sourceMappingURL=chunk-713887f0.5bdea75b.js.map